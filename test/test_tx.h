//
// Created by ryousuke kaga on 2024/02/08.
//

#ifndef BITCOIN_IN_CPP_TEST_TX_H
#define BITCOIN_IN_CPP_TEST_TX_H

#include <gtest/gtest.h>
#include <string>
#include "tx.h"


TEST(txTest, TxParsing) {
    unsigned char tx_raw[] = {
            1, 0, 0, 0, 1, 129, 63, 121, 1, 26, 203, 128, 146, 93, 254, 105, 179, 222, 243, 85, 254, 145, 75, 209, 217, 106, 63, 95, 113, 191, 131, 3, 198, 169, 137, 199, 209, 0, 0, 0, 0, 107, 72, 48, 69, 2, 33, 0, 237, 129, 255, 25, 46, 117, 163, 253, 35, 4, 0, 77, 202, 219, 116, 111, 165, 226, 76, 80, 49, 204, 252, 242, 19, 32, 176, 39, 116, 87, 201, 143, 2, 32, 122, 152, 109, 149, 92, 110, 12, 179, 93, 68, 106, 137, 211, 245, 97, 0, 244, 215, 246, 120, 1, 195, 25, 103, 116, 58, 156, 142, 16, 97, 91, 237, 1, 33, 3, 73, 252, 78, 99, 30, 54, 36, 165, 69, 222, 63, 137, 245, 216, 104, 76, 123, 129, 56, 189, 148, 189, 213, 49, 210, 226, 19, 191, 1, 107, 39, 138, 254, 255, 255, 255, 2, 161, 53, 239, 1, 0, 0, 0, 0, 25, 118, 169, 20, 188, 59, 101, 77, 202, 126, 86, 176, 77, 202, 24, 242, 86, 108, 218, 240, 46, 141, 154, 218, 136, 172, 153, 195, 152, 0, 0, 0, 0, 0, 25, 118, 169, 20, 28, 75, 199, 98, 221, 84, 35, 227, 50, 22, 103, 2, 203, 117, 244, 13, 247, 159, 234, 18, 136, 172, 25, 67, 6, 0
    };

    Tx tx = Tx::parse(tx_raw);

    ASSERT_EQ(tx.version, 1);
    ASSERT_EQ(tx.inputs.size(), 1);
    ASSERT_EQ(tx.inputs[0].prev_tx_id, 0);
    ASSERT_EQ(tx.inputs[0].sequence, 0xfffffffe);

    ASSERT_EQ(tx.outputs.size(), 2);
    ASSERT_EQ(tx.outputs[0].amount, 32454049);
    ASSERT_EQ(tx.outputs[1].amount, 10011545);

    ASSERT_EQ(tx.locktime, 410393);
}

#endif //BITCOIN_IN_CPP_TEST_TX_H
